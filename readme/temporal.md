---

# üß™ –°—Ü–µ–Ω–∞—Ä–∏–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è Temporal + Real DB)

## 1. –ó–∞–ø—É—Å–∫ (–ß–∏—Å—Ç—ã–π –ª–∏—Å—Ç)

–ß—Ç–æ–±—ã —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –º–µ—à–∞–ª–∏, –¥–∞–≤–∞–π –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–º –≤—Å—ë —Å –Ω—É–ª—è.

1.  **–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞):**
    ```bash
    docker compose down -v
    docker compose up -d
    ```
    *(–§–ª–∞–≥ `-v` —É–¥–∞–ª–∏—Ç —Å—Ç–∞—Ä—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã –º—ã –Ω–∞—á–∞–ª–∏ —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞).*

2.  **–û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
    *   [http://localhost:8080](http://localhost:8080) ‚Äî **Temporal UI** (–Ω–∞—à –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω).

---

## 2. –°—Ü–µ–Ω–∞—Ä–∏–π ‚Ññ1: –£—Å–ø–µ—à–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ (Happy Path)

**–õ–µ–≥–µ–Ω–¥–∞:** –ë–æ–≥–∞—Ç—ã–π —Å—Ç—É–¥–µ–Ω—Ç –ø–æ–∫—É–ø–∞–µ—Ç –¥–æ—Ä–æ–≥–æ–π –Ω–æ—É—Ç–±—É–∫.

### –®–∞–≥ 2.1: –°–æ–∑–¥–∞–µ–º –ë–æ–≥–∞—Ç–æ–≥–æ –°—Ç—É–¥–µ–Ω—Ç–∞
–°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `UserService`.

```bash
grpcurl -plaintext -d '{"user": {"login": "rich_student", "status": 1, "email": "rich@test.com"}}' localhost:8081 User.UserInternalService/StoreUser
```
üëâ **–°–ö–û–ü–ò–†–£–ô `userID` –∏–∑ –æ—Ç–≤–µ—Ç–∞!** (–ù–∞–∑–æ–≤–µ–º –µ–≥–æ `RICH_ID`).

### –®–∞–≥ 2.2: –ù–∞—á–∏—Å–ª—è–µ–º –µ–º—É –¥–µ–Ω—å–≥–∏ (PaymentService)
–¢–∞–∫ –∫–∞–∫ —É –Ω–∞—Å —Ç–µ–ø–µ—Ä—å **—Ä–µ–∞–ª—å–Ω–∞—è –ë–î**, –±–∞–ª–∞–Ω—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0. –ù—É–∂–Ω–æ "–∑–∞–∫–∏–Ω—É—Ç—å –¥–µ–Ω–µ–≥". –ú—ã –∏–¥–µ–º –Ω–∞–ø—Ä—è–º—É—é –≤ —Å–µ—Ä–≤–∏—Å –ø–ª–∞—Ç–µ–∂–µ–π.

–ó–∞–º–µ–Ω–∏ `RICH_ID` –Ω–∞ —Ç–æ—Ç, —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª:
```bash
grpcurl -plaintext -d '{"balance": {"userID": "RICH_ID", "balance": 100000}}' localhost:8085 Payment.PaymentInternalService/StoreUserBalance
```
*(–ú—ã –Ω–∞—á–∏—Å–ª–∏–ª–∏ 1000.00 —Ä—É–±–ª–µ–π, –±–∞–ª–∞–Ω—Å –≤ –∫–æ–ø–µ–π–∫–∞—Ö)*.

### –®–∞–≥ 2.3: –°–æ–∑–¥–∞–µ–º –¢–æ–≤–∞—Ä (ProductService)
–°–æ–∑–¥–∞–µ–º –Ω–æ—É—Ç–±—É–∫ —Å—Ç–æ–∏–º–æ—Å—Ç—å—é 500.00 —Ä—É–±–ª–µ–π (50000 –∫–æ–ø–µ–µ–∫).

```bash
grpcurl -plaintext -d '{"product": {"name": "MacBook Pro", "price": 50000}}' localhost:8083 Product.ProductInternalService/StoreProduct
```
üëâ **–°–ö–û–ü–ò–†–£–ô `productID` –∏–∑ –æ—Ç–≤–µ—Ç–∞!** (–ù–∞–∑–æ–≤–µ–º –µ–≥–æ `PROD_ID`).

---

### ‚è≥ –í–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç
–ü–æ–¥–æ–∂–¥–∏ 5-10 —Å–µ–∫—É–Ω–¥.
*   `UserService` –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–±—ã—Ç–∏–µ -> `PaymentService` —Å–æ–∑–¥–∞–ª –∞–∫–∫–∞—É–Ω—Ç.
*   `ProductService` –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–±—ã—Ç–∏–µ -> `OrderService` —Å–æ—Ö—Ä–∞–Ω–∏–ª —Ç–æ–≤–∞—Ä —É —Å–µ–±—è.
    –ï—Å–ª–∏ –ø–æ—Å–ø–µ—à–∏—Ç—å, –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ "Product not found".

---

### –®–∞–≥ 2.4: –°–æ–∑–¥–∞–µ–º –ó–∞–∫–∞–∑ (OrderService -> Temporal)
–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã. –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é.

–ó–∞–º–µ–Ω–∏ `RICH_ID` –∏ `PROD_ID`:
```bash
grpcurl -plaintext -d '{"userID": "RICH_ID", "items": [{"productID": "PROD_ID", "quantity": 1}]}' localhost:8087 Order.OrderInternalService/CreateOrder
```

‚úÖ **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í–µ—Ä–Ω—É–ª—Å—è `orderID`. –û—à–∏–±–æ–∫ –Ω–µ—Ç.

### üéì –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ Temporal UI:
1.  –ù–∞–π–¥–∏ workflow —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º **Completed** (–∑–µ–ª–µ–Ω—ã–π).
2.  –ö–ª–∏–∫–Ω–∏ –Ω–∞ `Run ID`.
3.  –ü–æ–∫–∞–∂–∏ —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π (Activity):
    *   `ReserveProducts` (–°–ø–∏—Å–∞–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤) ‚Äî **Completed**.
    *   `ProcessPayment` (–°–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥) ‚Äî **Completed**.
    *   `SendOrderCreatedNotification` (–ü–∏—Å—å–º–æ) ‚Äî **Completed**.

> **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:** *"–°–º–æ—Ç—Ä–∏—Ç–µ, —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—ã–ª–æ 1000 —Ä—É–±–ª–µ–π, —Ç–æ–≤–∞—Ä —Å—Ç–æ–∏—Ç 500. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –≤ –ë–î –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ, –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω."*

---

## 3. –°—Ü–µ–Ω–∞—Ä–∏–π ‚Ññ2: –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã –∏ –ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è (Rollback)

**–õ–µ–≥–µ–Ω–¥–∞:** –ë–µ–¥–Ω—ã–π —Å—Ç—É–¥–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –∫—É–ø–∏—Ç—å —Ç–æ—Ç –∂–µ –Ω–æ—É—Ç–±—É–∫, –Ω–æ –¥–µ–Ω–µ–≥ –Ω–µ—Ç.

### –®–∞–≥ 3.1: –°–æ–∑–¥–∞–µ–º –ë–µ–¥–Ω–æ–≥–æ –°—Ç—É–¥–µ–Ω—Ç–∞
```bash
grpcurl -plaintext -d '{"user": {"login": "poor_student", "status": 1, "email": "poor@test.com"}}' localhost:8081 User.UserInternalService/StoreUser
```
üëâ **–°–ö–û–ü–ò–†–£–ô –Ω–æ–≤—ã–π `userID`** (–ù–∞–∑–æ–≤–µ–º –µ–≥–æ `POOR_ID`).

**–î–µ–Ω–µ–≥ –µ–º—É –ù–ï –Ω–∞—á–∏—Å–ª—è–µ–º!** (–ë–∞–ª–∞–Ω—Å = 0).

### –®–∞–≥ 3.2: –ü—ã—Ç–∞–µ–º—Å—è –∫—É–ø–∏—Ç—å –Ω–æ—É—Ç–±—É–∫
–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ `PROD_ID` (—Ç–æ–≤–∞—Ä), –Ω–æ –Ω–æ–≤–æ–≥–æ `POOR_ID` (—é–∑–µ—Ä–∞).

```bash
grpcurl -plaintext -d '{"userID": "POOR_ID", "items": [{"productID": "PROD_ID", "quantity": 1}]}' localhost:8087 Order.OrderInternalService/CreateOrder
```

### üéì –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ Temporal UI:
1.  –ù–∞–π–¥–∏ –Ω–æ–≤—ã–π workflow. –ï–≥–æ —Å—Ç–∞—Ç—É—Å –±—É–¥–µ—Ç **Failed** (–ö—Ä–∞—Å–Ω—ã–π).
2.  –ö–ª–∏–∫–Ω–∏ –Ω–∞ –Ω–µ–≥–æ.
3.  –°–º–æ—Ç—Ä–∏ –∏—Å—Ç–æ—Ä–∏—é —Å–æ–±—ã—Ç–∏–π:
    *   `ReserveProducts` ‚Äî **Completed** (–¢–æ–≤–∞—Ä –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–ª–∏, —Ç–∞–∫ –∫–∞–∫ –Ω–∞–ª–∏—á–∏–µ –º—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∂–µ—Å—Ç–∫–æ, –∏–ª–∏ –æ–Ω –µ—Å—Ç—å).
    *   `ProcessPayment` ‚Äî **Failed** (–û—à–∏–±–∫–∞: `insufficient funds` / `Charge failed`).
    *   ‚¨áÔ∏è **–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ:**
    *   `ReleaseProducts` ‚Äî **Completed**.

> **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:** *"–ê –≤–æ—Ç —Ç—É—Ç —Å—Ä–∞–±–æ—Ç–∞–ª–∞ Saga (Distributed Transaction). –¢–æ–≤–∞—Ä —Å–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–ª–∏. –ù–æ –ø–æ—Ç–æ–º PaymentService –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤". Temporal —ç—Ç–æ —É–≤–∏–¥–µ–ª, –ø–æ—à–µ–ª –ø–æ –≤–µ—Ç–∫–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –∏ –≤—ã–∑–≤–∞–ª –º–µ—Ç–æ–¥ ReleaseProducts, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å —Ç–æ–≤–∞—Ä –Ω–∞ —Å–∫–ª–∞–¥. –°–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å –≤ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏."*

---

–≠—Ç–æ **–∏–¥–µ–∞–ª—å–Ω–∞—è** –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è: –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–∞—è –±–∞–∑–∞, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è). –£–¥–∞—á–∏!